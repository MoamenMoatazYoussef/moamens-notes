# AWS Essentials

## Table of Contents

## Prerequisites
- Basic understanding of what cloud computing is, check this course out: https://bit.ly/2pk3dB2
- Basic introduction to AWS cloud, check this course out: https://bit.ly/2OI8iO7
- There are no hard prerequisites for this course, but some things may help, like:
    + Basic understanding of computer networking.
    + Basic experience with linux.
    + Basic understanding of some of AWS's services.

## About the Course
This course is a practical hands-on course on how to use some of AWS's services, so this course won't focus on explaining the theoretical background of each service.

If you want a simple understanding of AWS first, check out this course:
Introduction to Amazon Web Serivces: https://bit.ly/2OI8iO7 <br/>

If you want a simple understanding of Cloud Computing in general, check out this course:
Introduction to Cloud Computing: https://bit.ly/2pk3dB2 <br/>

## AWS Account Basics
### AWS Free Tier
To be able to work with AWS, we'll need an AWS accout.
AWS provides something called AWS Free Tier, it's an option to use AWS resources to get some AWS experience at no cost.
Check out the documentation here:
https://amzn.to/2YEjP2f
To use AWS Free Tier, we'll need to create an AWS account.

### Create an AWS Account
To make an account, go to AWS website and choose Create AWS account, now you'll need:
- An email
- credit card info (even if you'll use the free subscription)
- Address
- Phone number, with the extension of your country
- Other personal info

***Note:*** AWS will draw 1$ from you bank account for verification then will return it once verification happens, don't worry about that.

In the middle, you'll receive an automated call from Amazon asking for a 4-digit number that will appear on your screen, enter it in the call and it will verify your identity.

Then, select Basic Plan (which is free). <br/>

Congrats, now you have an AWS account :smile: <br/>

Sign in to the console, and there you go :smile: <br/>

**Using the AWS Console** <br/>
The AWS Console is where you manage any of the AWS services that you'll use.

You can access an AWS service by searching in the search bar above, or choose it from the giant list in front of you.

Check out the service *Billing*, and the service *CloudWatch*.

**AWS Documentation** <br/>
Open the *Support* menu on the top right, you'll find Documentation, this is the official documentation of AWS.

Now, let's dive into the services of AWS :smile:

## AWS Core Services

### AWS Services - Identity and Access Management - IAM
This is a service that restricts access to AWS resources and services to authorized users.

We use it to create users for our team, as well as user groups, user roles (that allow access to specific things), and access policies.

Go to the AWS console, search for IAM, and select it. <br/>

When we created our account, it became a *root account*, this is an account that has all privileges and can do anything in AWS.

Any other user created isn't given any authorization except when the root account (or another account with authorization) assigns the new user account specific roles and access rights.

#### Setting up IAM
- Go to the console.
- Go to IAM, this will open your IAM Dashboard.
- There will be a list of 5 uncompleted tasks, these are *Best Practices*.
    + Delete root access keys.
    + Activate MFA.
    + Create Individual IAM users.
    + Use groups to assign permissions to users.
    + Apply an IAM password policy.

***Note:*** there is a lot of *AWS Best Practices*, you'll hear about that a lot.

So let's go over the tasks:
**Delete root access keys** <br/>
- This is a task that is concerned with the fact that your account is now a root account, it has all privileges and all access rights.
- It's better to create a new restricted user, then delete the root account and use the restricted user.
- This task is already completed, so don't do it.

**Activate MFA** <br/>
- This task acti Activate multi-factor authentication.
- This provides an additional layer of security, a random 6-digit code that we need to input (other than with our password), to log in.
- Types of MFA:
    + Virtual MFA: smartphone or tablet, we can use an app like Google Authenticator.
    + hardware Key Fob: it's like the *HSBC secure key*, a small physical device that's used to generate that code, it's ordered from Amazon. 
- In the IAM Dashboard, open the task *Activate MFA on your root account*, then click on *Manage MFA*.
- Choose Virtual MFA device.
- Open your mobile phone, download Google Authenticator (or any authentication app that's compatible with AWS, check the list provided in the window that just opened).
- Open the Google Authenticator.
- Click Begin Setup, Scan barcode, it will open the camera.
- Go back to the computer, to the AWS console, the IAM dashboard, in the window that was opened, click Next Step, a barcode will show up, scan it.
- A 6-digit will show up, type it in the MFA Code 1, then wait for a new one to generate on your phone.
- Type the new one in the next box MFA Code 2.
- Click on Assign MFA. 
Now you've activated MFA :smile:

**Create Individual IAM users** <br/>
Because of security reasons, it's better to not use a root account, and instead use accounts that have just enough access rights to accomplish their tasks.

We'll create a user for us:
- In the IAM Dashboard, open the task, click Manage Users.
- Click Add User.
- Give a user name.
- Check both checkboxes Programmatic access, and AWS Management Console access.
- Create a password, uncheck the "Require user to reset password" checkbox.
- Click Next.
- Here, we give this user some permissions and access rights, we can:
    + Add user to a group with permissions, where all users in a group have the same permissions.
    + Copy permissions from another user to this user.
    + Attach existing policies directly to the user, this is manually assigning permissins to the user.
- Click on the last one: Attach existing policies directly, a list will appear.
- Choose AdministratorAccess, then click Next twice, then Add User.
- Now, the user has been created, notice that a login link for this specific user has been created, this is what we will use when we log in to the new user :smile:
***Note:*** there's an access key and a secret key, we'll look at them later.

**Use groups to assign permissions to users** <br/>
User groups are an easy way to give users permissions, we make a group with permissions and add 10 users, now those 10 users have the same permissions, the Group permissions.

This is useful if we want to assign a user group to a specific department in our client company.

- Click on Manage Groups.
- Create a new group.
- Give it a name.
- Also, choose policies just like the user.
- Choose AdministratorAccess.
- Create the group.
Done :smile:

**Apply an IAM password policy** <br/>
This task makes other IAM users required to create strong passwords.
- Click on Manage Password Policy.
- Set password Policy.
- A list of checkboxes will appear, we can set restrictions on the passwords here.
- Check the Prevent Password Reuse box, and set the limit to 3 times, then Finish.

That's it, we've set up IAM in our AWS account :smile: <br/>

#### IAM Users and Policies
Here, we'll talk about how to create an use IAM users and policies. <br/>

Let's say we have a user: Max, Max should be able to access an S3 Bucket in AWS. To do that, we'll need to create an IAM account for Max, just like what we've done in the second task: **Create Individual IAM users** <br/>

Objectives:
1. Create an account for Max.
2. Give them access to S3.

1. While creating an IAM user, we'll choose something called Access Type:
    - **Programmatic access**: this provides the account with an access & secret access key (public/private key), so that they can access AWS resources using CLI or an application they're developing, this is good for developers.
    - **AWS Management Console Access**: the user can log in to the AWS console and manage their AWS resources from the console.
2. Give the account for Max the AWS Management Console Access.
3. In the Set Permissions, give Max the AmazonS3FullAccess permission. (To give the account access to S3 Bucket: Objective 2)
4. Add tags (optional), tags are key/value pairs attached to the account, set a new tag where the key is *Name* and the value is *Max*. 

Objective 1 and 2 completed :smile: <br/>

#### IAM User Groups
As we've said earlier, we can make user groups and assign access policies to them, then put users in those groups so that they get the group's policies.

We do this the same way we did in the task **Use groups to assign permissions to users** <br/>

**What if we want to give a user in a group some more access?** <br/>
We can put users in many groups, up to 10 groups, they get all the access policies of all the groups they're in.


For example, if Max is in group G1, which has the access policy for S3, and in the group G2, which has the access policy for EC2, then Max gets the access policy for S3 *and* EC2.

Creating a group:
1. In the IAM Dashboard, select Groups.
2. Create New Group.
3. Give the group a name.
4. Give the group Permissions, we'll give it three policies: 
    - AmazonS3FullAccess. 
    - AmazonEC2FullAccess. 
    - AmazonRDSFullAccess.

We'll use the other policies later.

#### IAM Roles
We have users and user groups, and gave them access policies so that they can access the S3 bucket.

But, what if *other* AWS services need access to S3? For example EC2 wants to access S3. :open_mouth:

An EC2 instance is a virtual server, it may have a service that wants to access S3, so how do we let that service access S3?

We don't attach policies directly to a service, instead, we use something else: *Role*.

A *Role* is like a user account but for services.

Let's create a role to further understand it:
1. In the IAM Dashboard, choose Roles.
2. Create role.
3. Next, Choose the service we want to give a role to.
3. Next, give it the permission AmazonS3FullAccess.
4. Next, (optional)
5. Next, Give the role a name.
6. Finish, that's it :smile:

### AWS Services - Virtual Private Cloud VPC

#### Introduction
A *Virtual Private Cloud*, or ***VPC***, is a private part of the AWS cloud for a specific client. It's basically a small cloud for the client, the client has full control over that small cloud. You know in Facebook you have your own profile that you control? It's the same concept, but for a cloud.

We use our *virtual private cloud* or ***VPC*** for our AWS services and resources, when we create a database, an EC2 instance, or any other AWS resource, they are created in our VPC.

Only us have access to the VPC except if we give access to others.

When we create an AWS account, a default VPC is created for us, let's check it out:
1. In the AWS Console, search for VPC.
2. Open it, the VPC Dashboard will open.

**How does VPC work?** <br/>
In your home, you use the internet, right? You connect your computer to the internet and that's it, you're online. <br/>
Well, it's not that simple, in fact your computer isn't connected to the internet, it's connected to your *private network*, which, in turn, is connected to the *global network* i.e. the *internet*.

**How does that work?** <br/>
- Your internet service provider ISP provides a connection to the internet.
- To connect to that connection, we need a *gateway*.
- A *modem* provides a gateway, and it connectes to a *router*.
- The connection passes from the router to a *firewall* which provides security.
- Finally, this connects to your computer.

So essentially, we have a private network at home and we connect THAT network to the internet. If any of the devices in this scenario isn't working properly, the connection doesn't work.

When data comes from the internet to your computer:
- Your commputer requests access to something in the internet.
- This request goes through the Firewall.
- Then it goes to our router, which determines if that communication is local or internet, if it's local it's kept into the home network, if not it goes to the modem, then to the internet.
- Finally, the traffic returned from the internet goes from the modem, to the router, through the firewall, to the device.

**The same concept in VPC** <br/>
- If we have different EC2 instances in our VPC.
- If our EC2 instance want something from the internet, the request goes through the *Network Access Control List* **NACL**, which is a virtual *firewall*.
- THen, it goes to a *route table*, which is like a *router*.
- Then, it goes to an *Internet Gateway*, which is like a *modem*, and sends the response to the internet.
- The traffic from the internet goes through the *Internet Gateway*, to the *Route table* and routed to the *EC2 instance*, goes through **NACL**, and finally arrives to the *EC2 instance*.

Let's examine these components. <br/>
#### Internet Gateway IGW
This is your modem, it provides a Gateway to the internet and to others for communication. <br/>
It's a *highly available* and *redundant* component.

In the VPC Dashboard,
- Click on Internet Gateways on the left panel.
- You'll see an internet gateway automatically created with the default VPC.
    + You'll see the state *Attached*, which means that it's already used by one of the VPCs you have.
    + You can choose it, then click on Actions, and choose Detatch, it will change the state to *Detatched*. Now your VPC can't connect to the internet.
    + Reattach the VPC.

***Note:*** a VPC can have ONE internet gateway (or ***IGW***) attached at a time.
***Note:*** also, if the VPC has active resources like EC2 instances or RDS databases, you cannot attach/detatch the ***IGW*** from the VPC.

#### Route Tables RTs
When you connect your computer to the internet, data starts coming and going between your computer and the internet, but not all data come from the same path.

The internet is basically a **GIGANTIC** network of servers, computers, routers, billions upon billions of devices connected to each other. It's like a gigantic city with thousands of roads, you can get from a place to another place using a million ways.

How do you get from a place to the other as fast as possible? By using the roads that has the least traffic.

This concept is also applied to the internet, if you open a Youtube Video, all the data in it doesn't come through one path, they can come from different paths, but still start their journey at Youtube servers and end their journey on your computer.

**How do these pieces of data (or *packets*) know which road to use?** <br/>
There is some kind of road regulator, called a *Router*, this device has a list of all destinations that you can get to from here, this list is called a *Route Table*.

When packets go to the router, the router uses the *Route Table* to direct each packet according to its destination and which route is of the least traffic.

**In AWS, we use the same concept** <br/>
Having an internet gateway or IGW isn't enough, we need to create a Route Table so that when data comes in, the Route Table knows the EC2 instances inside our VPC so it directs the incoming packets to the right EC2 instances.

In the VPC Dashboard,
- Choose Route Tables from the left panel.
- In the lower section, choose the Routes tab:
    + You'll see the range of IP addresses that's reserved for our VPC.
    + The target *local* means that, if data wants to go to an IP address that's in the range assigned to the VPC, keep this connection local.
    + Other than that, connect to the internet.
- If you detatch your IGW, then go back to Route Tables, to the Routes tab, you'll see that now the Route Table routes anything from the internet to *Black Hole*, which basically means that it's not able to route.
- If we attach another IGW, the *Black Hole* status won't change, because the route table references an *IGW*, the old entry still references the detatched IGW, that's why it's still *Black Hole*.
- Click Edit, remove the entry, then add a new entry, giving it the new attached *IGW*.

***Note:*** You can have many Route Tables in one VPC.
***Note:*** You cannot delete a Route Table if it has dependencies, like subnets or whatever.

#### Network Access Control List NACL
When you connect your computer to the internet, this connection goes through a *Firewall*, a Firewall is basically a gate that either *Allows* or *Denies* traffic passing through it according to some *rules*.

The rules that apply to incoming traffic are called *Inbound Rules*.
The rules that apply to outgoing traffic are called *Outbound Rules*.

There are two types of rules:
- *Allow Rules*: which says "Let the addresses and ports defined in this rule pass".
- *Deny Rules*: which says "Don't let the addresses and ports defined in this rule pass".

Your VPC can itself be divided into small networks, called *Subnets*, and NACLs are assigned to Subnets, so that any traffic going to or coming from a specific subnet, it will pass through all the NACLs assigned to that subnet.

In the VPC Dashboard,
- Click on Network ACLs.
- In the tab Inbound Rules.
- You can see the rules that are applied to any incoming traffic.

Rules in the NACL are applied in order from lowest to highest in *rule number*, so if we have a rule that applies to some traffic (With rule number 90), then another rule that applies to the same traffic (with rule number 100), the second rule is not applied.

For example, if we have these two rules:
+ Rule 1:
    - Rule #: 90
    - Protocol: SSH
    - Port Range: 22
    - Source: 0.0.0.0/0
    - Allow/Deny: Allow
+ Rule 2:
    - Rule #: 100
    - Protocol: SSH
    - Port Range: 22
    - Source: 0.0.0.0/0
    - Allow/Deny: Deny

SSH Traffic from any source in the port range 22 will be **ALLOWED**, the second rule won't be applied.

In the VPC Dashboard,
- Click on Network ACLs.
- In the tab Outbound Rules.
- You can see the rules that are applied to any outgoing traffic.
It's the same concept.

We can create an NACL ourselves.
- Click Create Network ACL.
- Give it a name.
- That's it, it'll be created:
    + It won't have any subnets associated with it.
    + Inbound Rules: a default rule is set to deny EVERYTHING.
    + Outbound Rules: a default rule is set to deny EVERYTHING.
- So, we need to create rules ourselves.

***Note:*** When creating rules, leave some space between each rule in terms of Rule Number, for example, number your rules 100, 110, 120, just in case you needed to add a rule between rule 100 and 110.

#### Subnets
If the ISP's network is a large network, then your computer is now part of it, so your home network is a small network, a subnetwork, a ***Subnet***, of the large ISP network.

When we create a VPC, it covers all availability zones. We can divide our VPC into ***Subnets***, each Subnet must reside entirely in ONE availability zone. Subnets are associated with Route Tables. If a Subnet isn't associated to a route table explicitly, it will be associated with the main route table.

There are two types of subnets:
- Public subnets, which have access to the internet. 
- Private subnets, which don't have access to the internet, but still can communicate with other subnets.
    + We make a subnet private by associating it with a Route Table that is NOT associated with an IGW.

In the VPC Dashboard,
- Go to Subnets in the left panel. You can see the subnets and you can create one:
    + Give it a name.
    + Specify a VPC for it to be part of.
    + Specify an availability zone for it to be contained inside.
- Go to Route Tables in the left panel, in each route table you can view the associated Subnets.
- Here, you can unassign the IGW from a Route Table so that it doesn't have access to the internet and any subnets associated with that route table are now *private*.

#### Availability Zones
The world -in the eyes of AWS- is divided into Regions, each Region is divided into Availability Zones, each Availability Zone is divided into AWS Data Centers, which house the AWS Servers that make the cloud.

When you create a VPC, it covers all Availability Zones within the Reigon. When you create a Subnet, it must reside entirely inside an Availability Zone.

When you create a VPC, some subnets are automatically created, one subnet for each Availability Zone covered by your VPC.

**Why use different availability zones?** <br/>
In one zone, we may have our primary web server and primary database. But in another zone, we may have a Backup web server and a secondary database.

If a disaster happens in the primary zone, the traffic will automatically be routed to the secondary zone, so we can still work with the backup server and database.

This gives us *High Availability* and *Fault Tolerance*. <br/>
Whenever we create a new system architecture in AWS, we must always have *High Availability* and *Fault Tolerance* in mind.

### AWS Services - Elastic Cloud Compute EC2

#### Basics of EC2
An EC2 instances is basically a computer that resides in the AWS cloud at one of the AWS data centers. <br/>

Basically it's the hardware where your code and database reside.

If you play a game on your PC, that's a normal scenario, but if you don't want to run the game on the PC, but still play it, then you can put the game on the AWS cloud and run it on the cloud.

When you do that, your game is running on one of the computers that AWS has in its data centers, that computer is called an EC2 instance, your game is running on an EC2 instance.

So, when we think about an EC2 instance, we still think about things like:
- The OS:
    + it's called an *Amazon Machine Image*, or ***AMI***, we load an ***AMI*** on an EC2 instance so that we can get access to the EC2 instance's OS.
- The processing power of its CPU:
    + It's called an ***Instance Type***.
- The hard drive:
    + EC2 instances use something called *Elastic Block Storage* or ***EBS***, this is the hard drive of the EC2 instances.
- The RAMs: it's like the normal RAM.
- The IP addressing: a virtual network adapter that gives us internet access on our EC2 instance.
- Firewall:
    + ***Security Groups***: we use them to select which ports to allow, etc.

As you can see, EC2 instances are just computers (with some fancy terms) owned and operated by AWS that we use to run our stuff.

And to use a computer, we need to decide on:
- What OS will we use, *which AMI to select*.
- What specs do we want, *what Instance Type do we choose*.
- How big is the hard drive, *how many EBS Volumes do we want*.
- How to configure a firewall to secure our PC, *how to configure Security Groups to protect our EC2 instance*.
- How do we connect to the internet, *what is the IP Addressing that we'll use*.
- How much RAM do we want.

Let's build our PC :smile:

#### Let's build a PC
##### Windows or Linux
Let's start with our OS. <br/>
If you have a PC with Windows, some games, and user settings.
Now, imagine that you can wrap up your Windows, games, and settings in some sort of a *bundle*.
Then, when your PC breaks down after years of use, you get a new PC.
But instead of starting a brand new OS with an empty PC, you actually install that *bundle* on your pc, so it acts like some sort of *template*, or *starting point*.
Now, when the new PC starts up, it doesn't show a new Windows, it shows your old Windows, and it has your Games and your settings.

That *bundle*, that *template* you used to install the new PC, is very similar to what we do when we use an EC2 instance in AWS.

When you create a new EC2 instance, Amazon doesn't want you as a client (or developer) to worry about what OS, what software, and all that, you just want to open the EC2 instance and start working.

So, Amazon followed that concept of a *bundle*, and made a lot of *bundles*, each has an OS, some helping software, and some settings.
 
For example you can find bundles that has:
- Windows and MySQL Server
- Linux, Python, PHP, and MSSQL Server
And so on.

These *bundles* are 
- Used in Amazon Web Services AWS, 
- They're used to initialize any EC2 instances, they are like templates, or *images*., 
- They initialize the *machines* that you use from the cloud.

So, they are called *Amazon Machine Images*, or ***AMIs***.

What the hell is an *AMI*? <br/>
An AMI is a bundle that includes the OS, additional applications, and any settings we might need on the EC2 instances.

We specify an AMI when we launch the EC2 instance, and we can make different instances of the same AMI.

There are three types of AMIs:
1. Community AMI.
2. Marketplace AMI.
3. My AMIs.

**A) Community AMI** <br/>
These are free to use, we just select an OS that we want.

**Steps** <br/>
Open the AWS console:
- Go to EC2.
- Choose Launch instance.
- The list that opened in front of you to choose an AMI, all of these are AMIs, with their own OS and other stuff you might need.
- Choose Community AMIs.
- Notice that the AMIs in the list mostly contain only the OS.

**B) AWS Marketplace AMI** <br/>
In the list you opened,
- Choose AWS Marketplace AMIs.
- These are AMIs with OSs and other stuff, these are paid for.

**C) My AMI** <br/>
These are the ones that you create by yourself.

##### The Specs of your PC
Let's imagine three PCs:
- PC1:
    + CPU: Core i7
    + RAM: 16 GB
    + Graphics Card: Nvidia GTX 1080 titan.
- PC2:
    + CPU: Pentium Dual-core
    + RAM: 6 GB
    + Graphics Card: Intel G43 Express Chipset
- PC3:
    + CPU: Pentium 2
    + RAM: 512 MB
    + Graphics Card: embedded in the CPU.

The first PC looks awesome, it's a gaming PC and it's a powerful one. The second one is a bit old, it's a barely working PC. The third one is essentially in a museum or something xD

Why did we divide them like that? <br/>
Because the specs of the first PC are a powerful package for games. The specs of the second PC are an old package. The third one is basically trash.

The *powerful package*, the group of awesome PC specs, can be bundled together and called *gaming specs*.

In AWS, you can get EC2 instances but what about their hardware and specs?
Well you're offered some bundles of specs, called ***Instance Types***.


**So what is an *Instance Type*?** <br/>
They are the hardware specs that you specify for an EC2 instance when you're creating it. 

**Steps** <br/>
In the AWS dashboard,
- Go to EC2
- Launch Instance.
- Choose one of the AMIs, for example the Amazon Linux AMI free tier eligible.
- The next screen will show a list of *Instance Types*, as you can see, there's CPU type, RAM, etc.
- It's even divided into families like General Purpose, GPU Optimized, etc.

##### The Hard Drive of your PC
When we buy a new PC, we also decide on the Hard drive, you know:
- Its capacity.
- Its performance.
- Its architecture, like is it an HDD or SSD or a combination of both, how much is SSD.

In AWS, we do the same, we determine how many Hard Drives we want, and the volume of each. 

These volumes aren't actually bound to the hardware machine, they are *virtual drives*, so we can add them or remove them from an EC2 instance anytime.

Also, we can remove volumes from an EC2 instance and add them to another EC2 instance that are in the same AWS availability zone, all done easily.

So, unlike our PC Hard Drive, these virtual drives are *Elastic*, and they are also available most of the time i.e. *Highly Available*.

But, like our PC hard drive, these virtual drives operate in the same way as a PC Hard drive, by using *Block storage*.

Therefore, these virtual drives are called *Elastic Block Storage*, or ***ELBs***.

The performance of an EBS volume is measured by ***IOPS***, *Input/output Operations Per Second*, the higher IOPS, the better performance, the unit of measure by KiB (*KibiBytes*).

**Steps** <br/>
In the AWS Console, 
- EC2
- Launch Instance
- Choose an AMI.
- Choose an Instance Type.
- You'll see the Step 4: Add Storage section, you can see the volumes that we can create.

We can also create EBS volumes separately and attach them to EC2 instances in the same availability zone.

##### The Firewall of your PC
To protect your new PC from being hacked or spoofed, we install various things, like an Antivirus, a Firewall, and other things.

Have you ever wondered what exactly is a firewall? <br/>
A firewall is basically a piece of software that acts like the main gate to your computer (or, more specifically, your personal *network*).

This gate oversees all incoming and outgoing traffic to and from your PC, and it allows or denies traffic based on some *rules*.

These *rules* are like:
- *Allow* videos from Youtube.
- *Deny* popups from thepiratebay.
- *Allow* ads from google.
- *Deny* spam emails.

As you can see, these rules are usually *Allow* something, or *Deny* something, so, they are named *Allow* rules, and *Deny* rules.

These *rules* are usually automatically configured by the Firewall or the company that made it.

In AWS, we also have a Firewall, but unlike the PC firewall, we can actually *write its rules ourselves*.

The Firewall we use in AWS is called a *Security Group*, and it's called that because we can apply *many* firewalls on the same EC2 instance.

And, in each firewall (or *Security Group*), we can define our own *Allow* rules.

**What's the difference between Security Groups and the Network Access Control List or *NACL*?** <br/>
The difference between it and these firewalls or *Security Groups* is that:
- We can only create *Allow* rules for *Security Groups*.
- But we can create *Allow* and *Deny* rules for the *NACL*.

**Steps** <br/>
In the EC2 Dashboard, on the left panel, 
- go to Security Groups.
- There will be a default Security Group, created when we create the default VPC when we create our AWS account.
- It's a default one and it has default values:
    + All data coming from outside is denied.
    + All data going from our EC2 instance to the outside is allowed. 
- There are two types of Rules for *Security Groups*:
    + **Inbound Rules**: rules that apply to incoming traffic.
    + **Outbound Rules**: rules that apply to outgoing traffic.
- Click on Create Security Group.
- Here, in the Inbound tab, there are no rules set which means that no inbound data is allowed from outside. (We must have *Allow* rules)
- In the Outbound tab, we'll notice that in the rules, the protocol is set to *All*, which means that all data going to outside is allowed.

- In the Inbound tab, click on Add Rule:
    + Type: HTTP.
    + Protocol: TCP.
    + Port Range: 80.
    + Source: Custom.
    + 0.0.0.0.80.
- This means that any inbound traffic from port 80 will be allowed.

Security Groups are *stateful*: If a packet of data is allowed inside, it will be able to leave **EVEN IF** we have outbound rules preventing that.

We only create *Allow* rules in Security Groups.

##### Connecting your PC to the internet
For your new PC to connect on the internet and communicate on any network, it needs an *IP Address*.

***Note:*** IP Addressing is a Computer Networks topic, it's not covered here, so if you don't know what it is, think of it as an address to your computer, just like your home address.

There are two types of IP Addresses:
- Private: used to communicate with any machine in the same *VPC*.
- Public: used to communicate with the internet.

**Steps** <br/>
Open your AWS Console,
- EC2.
- Launch Instance.
- Choose an AMI, Next.
- Choose an instance type, Next.
- In Step 3, notice in the Network section, *Auto-assign Public IP* is set to *Use subnet setting*, because this is based off of the default VPC.

So, any communication to and from your EC2 instances:
1. Incoming data passes through an Internet Gateway,
2. to a route table, which uses the instance's public IP address to find it, then passes through
3. *NACL*, which monitors the communication and allows or denies traffic according to rules, then it passes through
4. Security groups, which also allow or deny traffic according to rules, then 
5. it finally reaches your EC2 instance for processing.

The opposite for outgoing data.

Now, we're connected :smile: <br/>

### Launching an EC2 instance
Now let's actually go to AWS and do some work to launch an EC2 instance with all its configurations that we've examined so far.

**Steps** <br/>
In the AWS Console:
- EC2
- Launch Instance
- Choose an ***AMI*** (first configuration), select any AMI that are labeled "Free-tier eligible", Next.
- Choose an ***Instance Type*** (second configuration), choose *t2.micro*, the labeled "Free-tier eligible", Next.
- In Networking, keep the Default VPC, choose any subnet, leave the Auto-assign Public IP enabled, **don't click Next**.
- Scroll to the bottom.
- Now, we need to run a Bash script to:
    + Update software packages.
    + Install HTTP service (or *Apache* web service).
    + Start the service.
Copy this (without the dollar signs *$*):
``` sh
$ yum update -y
$ yup install -y http4
$ service http4 start
```
And paste it in the User Data section, Now click Next.
- A root volume will be automatically added, Next.
- Add a tag:
    + Key: main
    + Value: webserver
Next.
- Create a new security group:
    + Call it: EssentialSG
    + Add this rule:
        - Type: SSH
        - Protocol: TCp
        - Port Range: 22
        - IP: 0.0.0.0/0 (i.e. allow everything, that isn't best practice of course)
    + Add another rule, same stuff but the Type is *HTTP* not SSH. (also allow traffic from the internet)
- Launch.
- Launch again, choose Create a new key pair, calle it *essentialskp*.
- Download key pair.
- Launch.
- View instances.

It'll take some minutes to set up, we've created our first EC2 instance :smile: <br/>

When it's ready, click Connect,
- It'll show a warning that we need to execute this command:
``` sh
$ chmod 400 essentialskp.pem
```
This is essentially setting this file to read-only. Also, to connect, we'll see a Public DNS information, we should use that DNS name to connect to this EC2 instance.
There is also a link on how to connect using a software called *PuTTY* (Which we'll use on Windows).
It also has the hostname of the EC2 instance,

#### How to connect to EC2 instance from a Windows machine
- On your windows machine, download and install a software called *PuTTY*, just google it, it's a famous software.
- PuTTY and PuTTYgen will both be installed.
    + PuTTYgen is a software that will be used to conver the .pem file (the key pair file we downloaded when creating the instance).
- Open PuTTYgen, import the .pem file, and click Save Private Key.
- Now, open PuTTY, we need:
    + The hostname of the EC2 instance, copy it from the Example section in the thing that opens when you click Instances in the EC2 dashboard.
    + A username to connect to, you'll find it before the hostname, separated by @.
    + The private key we generated from PuTTYgen
- In the Session tab, paste the Hostname or IP address of the EC2 instance.
- In the Date tab, paste the user name.
- In the SSH tab, in the Auth subtab, browse and select the .ppk file.
- [Optional] in the Session tab, give a name for your session and save it (Just so we don't need to type in all of this info again).
- Click Open.

A terminal will open, and will show that you are connecting to the EC2 instance.

*Real nice* :sunglasses:

***Note:*** It may ask you to run "sudo yum update" to update packages, just type it in the terminal and press Enter.

**Connecting to an EC2 instance using Remote Desktop Protocol RDP** <br/>
In your EC2 dashboard,
- Go to Security Groups.
- Create a new Security Group with an inbound rule:
    + Type: RDP.
    + Protocol: TCP.
    + Port Range: 3389
    + Source: Custom 0.0.0.0/0

Then, go back to the dashboard,
- Launch Instance.
- Step 1: Select the free-tier Windows Server AMI.
- Step 2: Select the free-tier t2.micro instance type.
- Step 3:
    + Default VPC and Subnet.
    + Make Auto-assign Public IP enabled.
- Step 4: Storage is already added, Next.
- Step 5:
    + Key: Name
    + Value: WinRDP
- Step 6: Assign to the security group we created.
- Create a new key pair and download it, then launch the instance.
- When it's launched, click Connect, then Download Remote Desktop File.
- Click Get Password.
- Browse to the .pem key pair file.
- Decrypt Password.
- Copy the password and click Close.

Then, to connect using RDP,
- Open the .rdp file that was downloaded.
- You might get a message saying the connection may not be secure. Click Continue.
- In the User Account popup, paste in the password we just copied, and click Done and the Continue.
- The RDP connection should pop up :smile:

### AWS Services - Simple Storage Service S3

### AWS Services - Relational Database Service RDS
Our database is usually put in a separate, private subnet, so that only our EC2 instances have access to it, not the internet or outsiders.

#### To SQL or Not to SQL - That is the question
There are two types of Databases:
- Relational, or SQL databases.
- Non-relational, or NoSQL databases.

There are two databases in AWS:
- RDS, which is a SQL database service.
- DynamoDB, which is a NoSQL database.

##### RDS
The RDS isn't itself a database, it's a database *service*, it offers a wide range of SQL databases to choose from, like: Amazon Aurora (An Amazon-developed database compatible with MySql, sadly this is the only option that's not Free-Tier eligible), MySql, MSSQL, MariaDB, PostgreSQL, and Oracle.

The RDS service itself provides resizable capacity for a relationshal database and manages common database administration tasks. So, we don't have to install or manage any database software, we just provision an instance in the cloud.

**Steps** <br/>
In the AWS Console,
- Go to RDS.
- Create Database.
- You can see the different options, listed under the title *Engines*.

**Structure** <br/>
Like any SQL database, it stores data in *Tables* of *rows* and *columns*.

### DynamoDB
Like RDS, it's a database *service*, but unlike RDS, it doesn't offer different database options, it IS a database in of itself, it can replace other NoSql options like MongoDb, Cassandra DB, Oracle NoSql.

In the AWS Console,
- Go to DynamoDB.
- Notice that you only have the option to create tables and stuff i.e. *use* the database.

**Structure** <br/>
It stores data in key-value *documents* that is like JSON.

#### Connecting to and Privisioning an RDS Database
Remember, we don't want our RDS database to be internet accessible, so it's best to provision it in a private subnet.
To do that, we need to:
- Create a private subnet. (That has a private route table separate from the route table)
- Configure some *Security Groups* so that our EC2 instances can still communicate with the database.
- The same for *NACL*.

Then, we as developers want to connect to the EC2 instance, then the EC2 instance connect to the database.
We need to be able to connect through
- Internet,
- the internet gateway, 
- route table, 
- NACL, 
- security groups, 
- private route table,
- to the RDS.

So all of these components must work together to make that happen, this is called *SSH Tunneling*.

**Step 1** <br/>
In the AWS console,
- Go to RDS.
- Subnet Groups.
- Create a DB subnet group:
    + Give it a name: EssentialSubnetGroup (Set it in the description also)
    + VPC: select your VPC.
    + Availability Zone: choose two zones, for example us-east-1a and us-east-1c.
    + Click Create

**Step 2** <br/>
- Go back to the RDS dashboard
- Create Database, select MySQL, scroll down:
    + Give it a name: essentialdb
    + master username: admin
    + Create a password
    + DB instance size: burstable
    + t2.micro
    + Storage as default
    + Connectivity: default VPC
    + Publicly accessible: No
    + VPC security group: create new, call it essentialSG.
    + Availability zone: No preference.
    + Database port: 3306
    + Backup: change the backup retention period to 0 days.
    + Deletion protection: disable it.
    + Create Database.
The database will start creating.

**Step 3** <br/>
- Click on the database.
- Connectivity & Security tab, we'll need some stuff from here when we connect to our database.

**Step 4** <br/>
- Go back to AWS Console
- VPC
- Security Groups
- Select the security group we created when we made the database.
- Inbound rules.
- Edit rules.
- Change the rule to 0.0.0.0/0 to allow any TCP connection to port 3306 (Not a best practice, but for now we'll set it here)
- Add another rule:
    + Type: SSH
    + Port range: 22
    + 0.0.0.0/0
- Add another rule:
    + Type: All Traffic
    + same stuff.
- Save rules.
- Network ACLs, if there are no inbound rules that are similar to above, make them.

**Step 4** <br/>
- We can't access our RDS databas from the AWS console, so go to a new tab in your browser and download MySQL Workbench, we'll need:
    + .pem file we made when we created our EC2 instance earlier.
    + SSH hostname/public IP address of that instance.
    + SSH username for the instance.
    + Port 3306 is open.
    + Enter the username and password.
- Open the workbench.
- Add a MySQL Connection:
    + Give it a name.
    + Method: Standard TCP/IP over SSH
    + SSH Hostname: Go to the AWS Console, get the EC2 instance public IP or hostname.
    + SSH Username: Get the EC2 instance username.
    + SSH Key file: Browse to the .pem file you downloaded for the EC2 instance earlier.
    + MySQL Hostname: go to RDS, Databases, select your database, copy what's under Endpoint.
    + MySQL Server Port: 3306
    + Username: the username you used for the database.
    + Password: the password you used for the database. (Choose Store in keychain).
- Create.

That's it, now you're connected to the RDS Database through the MySQL Workbench :smile: <br/>

## AWS Complimentary Services
### AWS Services - Simple Notification Service SNS
#### Overview
Sometimes, we don't want to constantly open our AWS account to monitor everything, can't AWS just notify us when something happens?
Yes indeed, there is a *Simple Notification Service* or ***SNS***.

When an event happens, like a crash or something, the entities responsible for the event (Like a monitoring server), publishes a message describing that event, this message has a *Topic* (it's like the email subject), these entities are called *Publishers*.

Then, anyone who is interested in such event, is notified and can process this event accordingly. These are called *Subscribers*.

Subscribers listen to Topics, not specific events, so the flow is like this for example:
- Two events happen, one under the topic Crash Report, and another under the topic Status Update.
- Then, a monitoring server in AWS known as CloudWatch (Like the night's watch), publishes a message under each topic.
- Then, there are three servers that are subscribed to the topic Crash Report, and two servers that are subscriber to the topic Status Update.
- So, each server is notified for the topic it's subscribed to.
- One of the servers is subscribed to both topics, so it's notified for both.
- Each server now takes action according to which event it was notified about.

***Note from Moamen:*** This is a popular design pattern by the way, called the PubSub pattern, and it's based on an elementary design pattern called the Observer Pattern. I recommed checking both out in these sources:
- JavaScript Design Patterns (For the Observer and PubSub patterns, implemented in JavaScript).
- Head-First Design patterns (For the Observer pattern).

#### Using SNS
In the AWS Console,
- Choose Simple Notification Service.
- In the Create Topic section, give the name *EssentialsTopic*.
- Here there are some options, like:
    + Display Name: We only need this if we'll send text messages. (Use the same name *EssentialsTopic*)
    + Access Policy: you can see that we can add policies on who can publish this topic.
    + Delivery retry policy: what happens when delivery of the topic fails.
    + Tags: add a tag *Topic*, the value is *EssentialsTopic*.
- Click Create Topic.
- Done, you can see that something called ***ARN*** (short for *Amazon Resource Name*), this is a unique name assigned for each single thing that's created.

To create a subscription,
- Select Subscriptions from the left panel.
- Choose Create Subscription.
    + Choose your topic.
    + Choose the protocol: Email
    + Enter an email there, this email will receive a mail whenever an event under this topic is created.
- Create Subscription.
- Done, notice that you'll need to open your email and confirm it.

Publishing a message,
- Go to Topics.
- Choose your topic.
- Choose Publish Message.
- You can see the options you have, write any message.
- Publish the message.
- You'll receive an email that has your message :smile:

### AWS Services - CloudWatch
CloudWatch is a service that helps us monitor the other services within our AWS account. We can monitor them, see any events that happen to them, etc. and trigger alarms or notify us when events happens.
CloudWatch can also mintor metrics for our other services, and when these metrics reach a limit that we specify, an alarm is generated.

In you AWS Console,
- Go to CloudWatch.
- You can create:
    + Dashboards for metrics.
    + Custom metrics.
    + Alarms.
    + Billing Alarms.
    and so on.

**Creating a CloudWatch Dashboard** <br/>
In the CloudWatch Dashboard,
- Select Dashboards from the left panel.
- Create Dashboard, give it a name.
- Now, you'll see metric groups classified by the resources you have now.
- Choose EC2, a list of metrics will open.
- Choose CPUUitilization as a metric.
- Click Create Widget.
- You'll see that the Dashboard is created and it has a widget with a graph and numbers for the metric CPUUtilization.

**To create an alarm for a metric** <br/>
- Select Alarms from the left panel.
- Create alarm, select metric.
- Then select your metric just like before.
- Then, a page will open with the configurations of the alarm:
    + Name, instanceid, etc.
    + Static or Anomaly Detection, choose Static.
    + Set the value under *than...* to any value you like that's higher than the metric, check the metric's graph out.
- Next.
- Now, you can select an SNS topic (or create a new one) so that when the metric exceeds the threshold, the alarm is sent to the topic and any subscribers are notified.
- Next, give it a name and description.
- Finally, Create Alarm.

An alarm will be created with the data it received :smile:

***Note:*** It might show under the INSUFFICIENT_DATA tab, but wait on it for a while, it takes time to gather data points, then it will go under the OK tab.

#### CloudTrail
CloudWatch is an awesome tool, but there's an even more awesome tool called CloudTrail, it's a service that allows us to track certain actions taken by a user, role, server, or even an API.

In the AWS Console,
- Go to CloudTrail
- Create Trail.
- Give it a name.
- Choose which type of events to log.
- Choose which S3 bucket to trail.
- Also, choose in which S3 bucket do we store the logs generated by Cloudtrail.
- Create.



***Note:*** We may need to modify the S3 bucket's access to allow CloudTrail to trail it.
