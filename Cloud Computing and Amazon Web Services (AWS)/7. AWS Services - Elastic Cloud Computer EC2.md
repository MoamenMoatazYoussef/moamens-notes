# AWS Services - Elastic Cloud Compute EC2

## Basics of EC2
### EC2 Overview
An EC2 instances is basically a computer that resides in the AWS cloud at one of the AWS data centers. <br/>

Basically it's the hardware where your code and database reside.

If you play a game on your PC, that's a normal scenario, but if you don't want to run the game on the PC, but still play it, then you can put the game on the AWS cloud and run it on the cloud.

When you do that, your game is running on one of the computers that AWS has in its data centers, that computer is called an EC2 instance, your game is running on an EC2 instance.

So, when we think about an EC2 instance, we still think about things like:
- The OS:
    + it's called an *Amazon Machine Image*, or ***AMI***, we load an ***AMI*** on an EC2 instance so that we can get access to the EC2 instance's OS.
- The processing power of its CPU:
    + It's called an ***Instance Type***.
- The hard drive:
    + EC2 instances use something called *Elastic Block Storage* or ***EBS***, this is the hard drive of the EC2 instances.
- The RAMs: it's like the normal RAM.
- The IP addressing: a virtual network adapter that gives us internet access on our EC2 instance.
- Firewall:
    + ***Security Groups***: we use them to select which ports to allow, etc.

As you can see, EC2 instances are just computers (with some fancy terms) owned and operated by AWS that we use to run our stuff.

And to use a computer, we need to decide on:
- What OS will we use, *which AMI to select*.
- What specs do we want, *what Instance Type do we choose*.
- How big is the hard drive, *how many EBS Volumes do we want*.
- How to configure a firewall to secure our PC, *how to configure Security Groups to protect our EC2 instance*.
- How do we connect to the internet, *what is the IP Addressing that we'll use*.
- How much RAM do we want.

Let's build our PC :smile:

## Let's build a PC
### Windows or Linux
Let's start with our OS. <br/>
If you have a PC with Windows, some games, and user settings.
Now, imagine that you can wrap up your Windows, games, and settings in some sort of a *bundle*.
Then, when your PC breaks down after years of use, you get a new PC.
But instead of starting a brand new OS with an empty PC, you actually install that *bundle* on your pc, so it acts like some sort of *template*, or *starting point*.
Now, when the new PC starts up, it doesn't show a new Windows, it shows your old Windows, and it has your Games and your settings.

That *bundle*, that *template* you used to install the new PC, is very similar to what we do when we use an EC2 instance in AWS.

When you create a new EC2 instance, Amazon doesn't want you as a client (or developer) to worry about what OS, what software, and all that, you just want to open the EC2 instance and start working.

So, Amazon followed that concept of a *bundle*, and made a lot of *bundles*, each has an OS, some helping software, and some settings.
 
For example you can find bundles that has:
- Windows and MySQL Server
- Linux, Python, PHP, and MSSQL Server
And so on.

These *bundles* are 
- Used in Amazon Web Services AWS, 
- They're used to initialize any EC2 instances, they are like templates, or *images*., 
- They initialize the *machines* that you use from the cloud.

So, they are called *Amazon Machine Images*, or ***AMIs***.

What the hell is an *AMI*? <br/>
An AMI is a bundle that includes the OS, additional applications, and any settings we might need on the EC2 instances.

We specify an AMI when we launch the EC2 instance, and we can make different instances of the same AMI.

There are three types of AMIs:
1. Community AMI.
2. Marketplace AMI.
3. My AMIs.

**A) Community AMI** <br/>
These are free to use, we just select an OS that we want.

**Steps** <br/>
Open the AWS console:
- Go to EC2.
- Choose Launch instance.
- The list that opened in front of you to choose an AMI, all of these are AMIs, with their own OS and other stuff you might need.
- Choose Community AMIs.
- Notice that the AMIs in the list mostly contain only the OS.

**B) AWS Marketplace AMI** <br/>
In the list you opened,
- Choose AWS Marketplace AMIs.
- These are AMIs with OSs and other stuff, these are paid for.

**C) My AMI** <br/>
These are the ones that you create by yourself.

### The Specs of your PC
Let's imagine three PCs:
- PC1:
    + CPU: Core i7
    + RAM: 16 GB
    + Graphics Card: Nvidia GTX 1080 titan.
- PC2:
    + CPU: Pentium Dual-core
    + RAM: 6 GB
    + Graphics Card: Intel G43 Express Chipset
- PC3:
    + CPU: Pentium 2
    + RAM: 512 MB
    + Graphics Card: embedded in the CPU.

The first PC looks awesome, it's a gaming PC and it's a powerful one. The second one is a bit old, it's a barely working PC. The third one is essentially in a museum or something xD

Why did we divide them like that? <br/>
Because the specs of the first PC are a powerful package for games. The specs of the second PC are an old package. The third one is basically trash.

The *powerful package*, the group of awesome PC specs, can be bundled together and called *gaming specs*.

In AWS, you can get EC2 instances but what about their hardware and specs?
Well you're offered some bundles of specs, called ***Instance Types***.


**So what is an *Instance Type*?** <br/>
They are the hardware specs that you specify for an EC2 instance when you're creating it. 

**Steps** <br/>
In the AWS dashboard,
- Go to EC2
- Launch Instance.
- Choose one of the AMIs, for example the Amazon Linux AMI free tier eligible.
- The next screen will show a list of *Instance Types*, as you can see, there's CPU type, RAM, etc.
- It's even divided into families like General Purpose, GPU Optimized, etc.

### The Hard Drive of your PC
When we buy a new PC, we also decide on the Hard drive, you know:
- Its capacity.
- Its performance.
- Its architecture, like is it an HDD or SSD or a combination of both, how much is SSD.

In AWS, we do the same, we determine how many Hard Drives we want, and the volume of each. 

These volumes aren't actually bound to the hardware machine, they are *virtual drives*, so we can add them or remove them from an EC2 instance anytime.

Also, we can remove volumes from an EC2 instance and add them to another EC2 instance that are in the same AWS availability zone, all done easily.

So, unlike our PC Hard Drive, these virtual drives are *Elastic*, and they are also available most of the time i.e. *Highly Available*.

But, like our PC hard drive, these virtual drives operate in the same way as a PC Hard drive, by using *Block storage*.

Therefore, these virtual drives are called *Elastic Block Storage*, or ***ELBs***.

The performance of an EBS volume is measured by ***IOPS***, *Input/output Operations Per Second*, the higher IOPS, the better performance, the unit of measure by KiB (*KibiBytes*).

**Steps** <br/>
In the AWS Console, 
- EC2
- Launch Instance
- Choose an AMI.
- Choose an Instance Type.
- You'll see the Step 4: Add Storage section, you can see the volumes that we can create.

We can also create EBS volumes separately and attach them to EC2 instances in the same availability zone.

### The Firewall of your PC
To protect your new PC from being hacked or spoofed, we install various things, like an Antivirus, a Firewall, and other things.

Have you ever wondered what exactly is a firewall? <br/>
A firewall is basically a piece of software that acts like the main gate to your computer (or, more specifically, your personal *network*).

This gate oversees all incoming and outgoing traffic to and from your PC, and it allows or denies traffic based on some *rules*.

These *rules* are like:
- *Allow* videos from Youtube.
- *Deny* popups from thepiratebay.
- *Allow* ads from google.
- *Deny* spam emails.

As you can see, these rules are usually *Allow* something, or *Deny* something, so, they are named *Allow* rules, and *Deny* rules.

These *rules* are usually automatically configured by the Firewall or the company that made it.

In AWS, we also have a Firewall, but unlike the PC firewall, we can actually *write its rules ourselves*.

The Firewall we use in AWS is called a *Security Group*, and it's called that because we can apply *many* firewalls on the same EC2 instance.

And, in each firewall (or *Security Group*), we can define our own *Allow* rules.

**What's the difference between Security Groups and the Network Access Control List or *NACL*?** <br/>
The difference between it and these firewalls or *Security Groups* is that:
- We can only create *Allow* rules for *Security Groups*.
- But we can create *Allow* and *Deny* rules for the *NACL*.

**Steps** <br/>
In the EC2 Dashboard, on the left panel, 
- go to Security Groups.
- There will be a default Security Group, created when we create the default VPC when we create our AWS account.
- It's a default one and it has default values:
    + All data coming from outside is denied.
    + All data going from our EC2 instance to the outside is allowed. 
- There are two types of Rules for *Security Groups*:
    + **Inbound Rules**: rules that apply to incoming traffic.
    + **Outbound Rules**: rules that apply to outgoing traffic.
- Click on Create Security Group.
- Here, in the Inbound tab, there are no rules set which means that no inbound data is allowed from outside. (We must have *Allow* rules)
- In the Outbound tab, we'll notice that in the rules, the protocol is set to *All*, which means that all data going to outside is allowed.

- In the Inbound tab, click on Add Rule:
    + Type: HTTP.
    + Protocol: TCP.
    + Port Range: 80.
    + Source: Custom.
    + 0.0.0.0.80.
- This means that any inbound traffic from port 80 will be allowed.

Security Groups are *stateful*: If a packet of data is allowed inside, it will be able to leave **EVEN IF** we have outbound rules preventing that.

We only create *Allow* rules in Security Groups.

### Connecting your PC to the internet
For your new PC to connect on the internet and communicate on any network, it needs an *IP Address*.

***Note:*** IP Addressing is a Computer Networks topic, it's not covered here, so if you don't know what it is, think of it as an address to your computer, just like your home address.

There are two types of IP Addresses:
- Private: used to communicate with any machine in the same *VPC*.
- Public: used to communicate with the internet.

**Steps** <br/>
Open your AWS Console,
- EC2.
- Launch Instance.
- Choose an AMI, Next.
- Choose an instance type, Next.
- In Step 3, notice in the Network section, *Auto-assign Public IP* is set to *Use subnet setting*, because this is based off of the default VPC.
- 

So, any communication to and from your EC2 instances:
1. Incoming data passes through an Internet Gateway,
2. to a route table, which uses the instance's public IP address to find it, then passes through
3. *NACL*, which monitors the communication and allows or denies traffic according to rules, then it passes through
4. Security groups, which also allow or deny traffic according to rules, then 
5. it finally reaches your EC2 instance for processing.

The opposite for outgoing data.

Now, we're connected :smile: <br/>

## Launching an EC2 instance
Now let's actually go to AWS and do some work to launch an EC2 instance with all its configurations that we've examined so far.

**Steps** <br/>
In the AWS Console:
- EC2
- Launch Instance
- Choose an ***AMI*** (first configuration), select any AMI that are labeled "Free-tier eligible", Next.
- Choose an ***Instance Type*** (second configuration), choose *t2.micro*, the labeled "Free-tier eligible", Next.
- In Networking, keep the Default VPC, choose any subnet, leave the Auto-assign Public IP enabled, **don't click Next**.
- Scroll to the bottom.
- Now, we need to run a Bash script to:
    + Update software packages.
    + Install HTTP service (or *Apache* web service).
    + Start the service.
Copy this (without the dollar signs *$*):
``` sh
$ yum update -y
$ yup install -y http4
$ service http4 start
```
And paste it in the User Data section, Now click Next.
- A root volume will be automatically added, Next.
- Add a tag:
    + Key: main
    + Value: webserver
Next.
- Create a new security group:
    + Call it: EssentialSG
    + Add this rule:
        - Type: SSH
        - Protocol: TCp
        - Port Range: 22
        - IP: 0.0.0.0/0 (i.e. allow everything, that isn't best practice of course)
    + Add another rule, same stuff but the Type is *HTTP* not SSH. (also allow traffic from the internet)
- Launch.
- Launch again, choose Create a new key pair, calle it *essentialskp*.
- Download key pair.
- Launch.
- View instances.

It'll take some minutes to set up, we've created our first EC2 instance :smile: <br/>

When it's ready, click Connect,
- It'll show a warning that we need to execute this command:
``` sh
$ chmod 400 essentialskp.pem
```
This is essentially setting this file to read-only. Also, to connect, we'll see a Public DNS information, we should use that DNS name to connect to this EC2 instance.
There is also a link on how to connect using a software called *PuTTY* (Which we'll use on Windows).
It also has the hostname of the EC2 instance,

#### How to connect to EC2 instance from a Windows machine
- On your windows machine, download and install a software called *PuTTY*, just google it, it's a famous software.
- PuTTY and PuTTYgen will both be installed.
    + PuTTYgen is a software that will be used to conver the .pem file (the key pair file we downloaded when creating the instance).
- Open PuTTYgen, import the .pem file, and click Save Private Key.
- Now, open PuTTY, we need:
    + The hostname of the EC2 instance, copy it from the Example section in the thing that opens when you click Instances in the EC2 dashboard.
    + A username to connect to, you'll find it before the hostname, separated by @.
    + The private key we generated from PuTTYgen
- In the Session tab, paste the Hostname or IP address of the EC2 instance.
- In the Date tab, paste the user name.
- In the SSH tab, in the Auth subtab, browse and select the .ppk file.
- [Optional] in the Session tab, give a name for your session and save it (Just so we don't need to type in all of this info again).
- Click Open.

A terminal will open, and will show that you are connecting to the EC2 instance.

*Real nice* :sunglasses:

***Note:*** It may ask you to run "sudo yum update" to update packages, just type it in the terminal and press Enter.




